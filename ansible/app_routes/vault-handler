import axios from "axios";

export async function getMachineCredentials(machineName) {
  const vaultToken = process.env.VAULT_TOKEN; // Make sure this is securely injected
  const vaultUrl = `http://vault:8200/v1/secret/data/machines/${machineName}`;
  console.log(vaultUrl);
  try {
    const response = await axios.get(vaultUrl, {
      headers: {
        "X-Vault-Token": vaultToken,
      },
    });
    console.log(response);
    const { username, password } = response.data.data.data;
    console.log(username, password);
    return { username, password };
  } catch (error) {
    console.error(
      "Error fetching Vault secrets:",
      error.response?.data || error.message
    );
    throw new Error("Failed to retrieve credentials from Vault");
  }
}
